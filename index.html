int soilPin = A0;
int pumpPin = D2;
int led1    = D3;
int buzzer  = D4;
void setup() {

  pinMode(led1, OUTPUT);
  pinMode(pumpPin, OUTPUT);
  digitalWrite(pumpPin, LOW);
  digitalWrite(buzzer, OUTPUT);
  Serial.begin(9600);
}

void loop() {

  int raw = analogRead(soilPin);
  int moisture = map(raw, 1023, 300, 0, 100);
  moisture = constrain(moisture, 0, 100);

  Serial.print("Moisture: ");
  Serial.print(moisture);
  Serial.println("%");

  if (moisture < 60) {
    tone(buzzer, 1000); // เล่นเสียง 1kHz
    delay(300);
    noTone(buzzer);     // ปิดเสียง
    delay(300);
    digitalWrite(pumpPin, HIGH); // เปิดปั๊ม
    Serial.println("Pump: ON");
    digitalWrite(led1, HIGH);

  }
  else if (moisture > 70) {
    noTone(buzzer);     // ปิดเสียง
    delay(500);
    digitalWrite(pumpPin, LOW); // ปิดปั๊ม
    Serial.println("Pump: OFF");
    digitalWrite(led1, LOW);
  }

  delay(500);
}